apiVersion: v1
kind: ConfigMap
metadata:
  name: datahub-ingestion-polaris
  namespace: datahub
data:
  polaris-recipe.yaml: |
    # DataHub Ingestion Recipe for Apache Polaris (Iceberg REST Catalog)
    # This recipe ingests table metadata from Polaris into DataHub
    
    source:
      type: iceberg
      config:
        env: "DEV"
        # Iceberg REST Catalog configuration (Polaris)
        # Key is the catalog name, value is pyiceberg catalog config
        catalog:
          polaris:
            type: rest
            uri: http://polaris.polaris.svc:8181/api/catalog
            credential: "root:s3cr3t"
            warehouse: polaris
            scope: "PRINCIPAL_ROLE:ALL"
            oauth2-server-uri: http://polaris.polaris.svc:8181/api/catalog/v1/oauth/tokens
            header.Polaris-Realm: POLARIS
            io-impl: org.apache.iceberg.aws.s3.S3FileIO
            s3.endpoint: http://minio.minio.svc:9000
            s3.access-key-id: admin
            s3.secret-access-key: password
            s3.path-style-access: "true"
            s3.region: us-east-1
        
        # Platform instance for disambiguation
        platform_instance: "polaris-dev"
        
        # Profiling (optional - can be resource intensive)
        profiling:
          enabled: false
    
    # Transform metadata (optional)
    transformers:
      - type: "simple_add_dataset_ownership"
        config:
          owner_urns:
            - "urn:li:corpuser:datahub"
    
    sink:
      type: datahub-rest
      config:
        server: http://datahub-datahub-gms.datahub.svc:8080

